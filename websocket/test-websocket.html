<!DOCTYPE html>
<html>
<head>
    <title>STOMP WebSocket Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.2.0/bundles/stomp.umd.min.js"></script>
</head>
<body>
<h1>WebSocket STOMP Test</h1>
<button onclick="connect()">Connect</button>
<button onclick="sendMessage()">Send Hello</button>
<button onclick="disconnect()">Disconnect</button>
<pre id="log"></pre>

<script>
    const CLIENT_ID = 'jono';
    const log = (msg) => (document.getElementById("log").textContent += msg + "\n");

    let client = null;

    function connect() {
        // Choose one: SockJS or native WebSocket
        client = new StompJs.Client({
            // If your server uses SockJS:
            // webSocketFactory: () => new SockJS(WS_URL),
            // If using native WebSocket instead, comment above and uncomment:
            brokerURL: 'ws://localhost:8080/ws',

            reconnectDelay: 5000, // auto-reconnect
            debug: (str) => log('DEBUG: ' + str),

            onConnect: (frame) => {
                log('[Connected] :: ' + CLIENT_ID);

                // Subscribe to a topic
                client.subscribe('/topic/greetings', msg => {
                    log('[Received]: ' + msg.body);
                });

                /*// Example: send a message to your controller mapping /app/hello
                client.publish({
                    destination: '/app/hello',
                    body: JSON.stringify({content: 'Web.client'}),
                });*/
            },

            onDisconnect: () => log('[Disconnected]'),
            onStompError: (frame) => log('Broker error: ' + frame.headers['message']),
        });

        client.activate();
    }

    function sendMessage() {
        if (client.connected) {
            client.subscribe('/user/queue/testuser', msg => log('[Received.direct]: ' + msg.body));
            client.publish({
                destination: "/app/testuser/MY_TEXT",
                body: "testuser." + CLIENT_ID,
            });

            client.publish({
                destination: "/app/hello",
                body: JSON.stringify({content: "Web.client:Content"}),
            });
            log("[Sent]");
        } else {
            log("[Not connected]");
        }
    }

    function disconnect() {
        if (client && client.active) {
            client.deactivate().then(() => log('[Disconnected by user]'));
        }
    }
</script>
</body>
</html>
